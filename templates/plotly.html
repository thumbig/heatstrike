<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Plotly Matrix</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 16px; }
      form { display: grid; grid-template-columns: repeat(4, minmax(200px, 1fr)); gap: 12px; align-items: end; }
      fieldset { border: 1px solid #ddd; padding: 10px; border-radius: 8px; }
      legend { font-weight: 600; }
      label { display: block; font-size: 12px; color: #333; margin-bottom: 4px; }
      input[type="text"], input[type="number"], input[type="date"], select { width: 100%; padding: 6px; }
      .row { grid-column: 1 / -1; display: flex; gap: 12px; align-items: center; }
      .btn { padding: 8px 12px; border-radius: 6px; border: 1px solid #bbb; background: #f7f7f7; cursor: pointer; }
      .btn:hover { background: #eee; }
      .notice { color: #666; font-size: 12px; }
    </style>
  </head>
  <body>
    <h1>Plotly Options Matrix</h1>

    <form method="get" action="{{ url_for('ui.plotly_view') }}">
      <fieldset>
        <legend>Underlying & Metric</legend>
        <label>Symbol</label>
        <input type="text" name="symbol" value="{{ symbol or 'AAPL' }}" placeholder="AAPL, SPY, NVDA" />
        <label>Metric</label>
        <select name="metric">
          <option value="mispriced" {% if metric=='mispriced' %}selected{% endif %}>Mispriced</option>
          <option value="gamma" {% if metric=='gamma' %}selected{% endif %}>Gamma</option>
          <option value="theta" {% if metric=='theta' %}selected{% endif %}>Theta</option>
        </select>
        <label>Paper</label>
        <select name="paper">
          <option value="1" {% if paper %}selected{% endif %}>Yes</option>
          <option value="0" {% if not paper %}selected{% endif %}>No</option>
        </select>
      </fieldset>

      <fieldset>
        <legend>Plot Options</legend>
        <label>Side-by-side Calls/Puts</label>
        <select name="side_by_side">
          <option value="1" {% if side_by_side %}selected{% endif %}>Yes</option>
          <option value="0" {% if not side_by_side %}selected{% endif %}>No</option>
        </select>
        <label>Y-Axis Order</label>
        <select name="y_order">
          <option value="desc" {% if y_order=='desc' %}selected{% endif %}>Descending</option>
          <option value="asc" {% if y_order=='asc' %}selected{% endif %}>Ascending</option>
        </select>
        <label>Annotate</label>
        <select name="annotate">
          <option value="iv" {% if annotate=='iv' %}selected{% endif %}>IV</option>
          <option value="theo" {% if annotate=='theo' %}selected{% endif %}>Theoretical Price</option>
          <option value="symbol" {% if annotate=='symbol' %}selected{% endif %}>Symbol</option>
          <option value="none" {% if annotate=='none' %}selected{% endif %}>None</option>
        </select>
      </fieldset>

      <fieldset>
        <legend>Selection</legend>
        <label>Expiries (N)</label>
        <input type="number" min="1" name="n_expiries" value="{{ n_expiries or 9 }}" />
        <label>Strikes per Expiry (k)</label>
        <input type="number" min="1" name="k_per_expiry" value="{{ k_per_expiry or 11 }}" />
        <label>Every Nth Strike (step)</label>
        <input type="number" min="1" name="step" value="{{ step or 2 }}" />
        <label>Per-Expiry Cap</label>
        <input type="number" min="1" name="per_expiry_cap" value="{{ per_expiry_cap or 10 }}" />
      </fieldset>

      <fieldset>
        <legend>Constraints</legend>
        <label>Strike Min</label>
        <input type="number" step="0.01" name="strike_min" value="{{ strike_min or '' }}" />
        <label>Strike Max</label>
        <input type="number" step="0.01" name="strike_max" value="{{ strike_max or '' }}" />
        <label>Expiry Start</label>
        <input type="date" name="exp_start" value="{{ exp_start_val or '' }}" />
        <label>Expiry End</label>
        <input type="date" name="exp_end" value="{{ exp_end_val or '' }}" />
        <label>Strikes Count (centered around ATM)</label>
        <input type="number" min="1" name="strikes_count" value="{{ strikes_count or '' }}" />
      </fieldset>

      <div class="row">
        <button class="btn" type="submit">Update</button>
        {% if spot %}
          <div>Spot for {{ symbol }}: <strong>${{ "%.2f"|format(spot) }}</strong></div>
        {% endif %}
      </div>
    </form>

    <div style="margin-top:16px;">
      {{ plot_html|safe }}
    </div>
  </body>
</html>


